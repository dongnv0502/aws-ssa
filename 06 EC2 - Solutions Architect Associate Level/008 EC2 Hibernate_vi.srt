1
00:00:00,100 --> 00:00:02,350
Hãy nói về một tính năng ít người biết

2
00:00:02,350 --> 00:00:04,210
gọi là EC2 Hibernate.

3
00:00:04,210 --> 00:00:06,670
Chúng ta biết có thể stop và terminate instance,

4
00:00:06,670 --> 00:00:08,860
khi stop,

5
00:00:08,860 --> 00:00:10,720
dữ liệu trên đĩa EBS của bạn

6
00:00:10,720 --> 00:00:13,480
sẽ được giữ nguyên đến lần khởi động tiếp theo.

7
00:00:13,480 --> 00:00:14,313
Điều đó hợp lý.

8
00:00:14,313 --> 00:00:16,170
Nếu chúng ta terminate,

9
00:00:16,170 --> 00:00:17,290
nếu bạn cấu hình root volume

10
00:00:17,290 --> 00:00:18,480
xóa cùng instance,

11
00:00:18,480 --> 00:00:19,700
nó sẽ bị xóa,

12
00:00:19,700 --> 00:00:22,430
còn volume nào không cấu hình xóa

13
00:00:22,430 --> 00:00:25,300
khi instance bị terminate sẽ được giữ lại.

14
00:00:25,300 --> 00:00:27,070
Khi bạn start instance,

15
00:00:27,070 --> 00:00:29,300
hệ điều hành sẽ boot,

16
00:00:29,300 --> 00:00:32,100
rồi EC2 User Data được chạy,

17
00:00:32,100 --> 00:00:35,270
script và hệ điều hành hoàn tất khởi động.

18
00:00:35,270 --> 00:00:38,780
Sau đó ứng dụng chạy, cache được nạp,

19
00:00:38,780 --> 00:00:40,130
và điều đó mất thời gian,

20
00:00:40,130 --> 00:00:43,060
vì bạn đang boot máy mà.

21
00:00:43,060 --> 00:00:44,800
Nhưng với Hibernate,

22
00:00:44,800 --> 00:00:46,920
chúng ta muốn trạng thái khác.

23
00:00:46,920 --> 00:00:50,350
Khi hibernate instance, mọi thứ trong RAM

24
00:00:50,350 --> 00:00:53,150
trạng thái trong bộ nhớ sẽ được giữ lại.

25
00:00:53,150 --> 00:00:53,983
Điều đó nghĩa là gì?

26
00:00:53,983 --> 00:00:55,940
Nghĩa là quá trình boot của instance

27
00:00:55,940 --> 00:00:57,180
sẽ nhanh hơn nhiều,

28
00:00:57,180 --> 00:01:00,400
vì hệ điều hành không dừng hay khởi động lại,

29
00:01:00,400 --> 00:01:02,930
nó chỉ bị đóng băng,

30
00:01:02,930 --> 00:01:04,349
được hibernate.

31
00:01:04,349 --> 00:01:05,800
Bên dưới,

32
00:01:05,800 --> 00:01:08,270
mọi dữ liệu trong RAM sẽ được ghi

33
00:01:08,270 --> 00:01:11,660
vào một file trên root EBS volume.

34
00:01:11,660 --> 00:01:14,500
Vì vậy root EBS volume phải được mã hóa

35
00:01:14,500 --> 00:01:17,840
và đủ dung lượng để chứa dữ liệu RAM.

36
00:01:17,840 --> 00:01:19,080
Hãy xem chuyện gì xảy ra.

37
00:01:19,080 --> 00:01:20,530
Chúng ta có một EC2 instance,

38
00:01:20,530 --> 00:01:23,560
nó đang chạy và có dữ liệu trong RAM,

39
00:01:23,560 --> 00:01:26,460
rồi ta bắt đầu quá trình hibernate.

40
00:01:26,460 --> 00:01:28,520
Khi đó instance sẽ chuyển

41
00:01:28,520 --> 00:01:30,030
sang trạng thái stopping,

42
00:01:30,030 --> 00:01:34,730
và RAM được dump vào EBS volume.

43
00:01:34,730 --> 00:01:37,850
Sau đó instance tắt và RAM biến mất,

44
00:01:37,850 --> 00:01:41,200
vì khi stop thì RAM bị xóa,

45
00:01:41,200 --> 00:01:45,370
nhưng EBS volume vẫn giữ bản dump của RAM.

46
00:01:45,370 --> 00:01:47,870
Khi instance được start lại,

47
00:01:47,870 --> 00:01:50,730
RAM sẽ được nạp từ đĩa

48
00:01:50,730 --> 00:01:53,150
vào bộ nhớ của instance.

49
00:01:53,150 --> 00:01:56,570
Điều đó nghĩa là

50
00:01:56,570 --> 00:01:58,500
EC2 instance như chưa từng bị stop.

51
00:01:58,500 --> 00:02:01,090
Chúng ta sẽ xem điều này trong phần hands-on.

52
00:02:01,090 --> 00:02:03,130
Vậy use case cho hibernate là

53
00:02:03,130 --> 00:02:05,300
khi bạn có các tiến trình chạy dài

54
00:02:05,300 --> 00:02:07,480
và không muốn dừng chúng,

55
00:02:07,480 --> 00:02:09,500
hoặc muốn lưu trạng thái RAM,

56
00:02:09,500 --> 00:02:13,006
hoặc chỉ muốn khởi động rất nhanh,

57
00:02:13,006 --> 00:02:16,060
khi dịch vụ mất thời gian khởi tạo.

58
00:02:16,060 --> 00:02:17,360
Bạn không muốn chúng khởi tạo lại,

59
00:02:17,360 --> 00:02:19,710
mà muốn chúng tiếp tục chạy

60
00:02:19,710 --> 00:02:23,210
kể cả khi bạn hibernate instance.

61
00:02:23,210 --> 00:02:25,730
Một số điều cần biết về EC2 Hibernate là

62
00:02:25,730 --> 00:02:27,990
nó hỗ trợ nhiều loại instance.

63
00:02:27,990 --> 00:02:31,230
Dung lượng RAM phải dưới 150 GB.

64
00:02:31,230 --> 00:02:32,140
Con số này có thể thay đổi,

65
00:02:32,140 --> 00:02:34,730
và bạn không bị hỏi giới hạn trong kỳ thi,

66
00:02:34,730 --> 00:02:37,130
tôi chỉ đưa ra để bạn hình dung

67
00:02:37,130 --> 00:02:39,500
cách nó hoạt động.

68
00:02:39,500 --> 00:02:42,220
Nó không hoạt động với bare metal instances.

69
00:02:42,220 --> 00:02:44,280
Nó chạy được trên nhiều hệ điều hành,

70
00:02:44,280 --> 00:02:46,510
bao gồm Linux và Windows.

71
00:02:46,510 --> 00:02:47,360
Nó áp dụng cho root volume,

72
00:02:47,360 --> 00:02:49,660
nên root volume phải là EBS,

73
00:02:49,660 --> 00:02:51,410
và phải được mã hóa.

74
00:02:51,410 --> 00:02:53,330
Volume này cũng phải đủ lớn để chứa RAM

75
00:02:53,330 --> 00:02:54,790
được dump vào.

76
00:02:54,790 --> 00:02:56,610
Hibernate dùng được cho mọi loại instance,

77
00:02:56,610 --> 00:02:59,750
như on-demand, reserved và spot.

78
00:02:59,750 --> 00:03:04,180
Thời gian hibernate tối đa khoảng 60 ngày.

79
00:03:04,180 --> 00:03:05,280
Con số này có thể thay đổi,

80
00:03:05,280 --> 00:03:08,000
nhưng hiện tại giới hạn là như vậy.

81
00:03:08,000 --> 00:03:10,340
Đó là tất cả cho bài giảng này, hy vọng bạn thích,

82
00:03:10,340 --> 00:03:13,040
hẹn gặp bạn trong bài hands-on tiếp theo.

