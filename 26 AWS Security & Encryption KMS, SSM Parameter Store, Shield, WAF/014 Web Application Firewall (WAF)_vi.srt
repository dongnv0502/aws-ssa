1
00:00:00,240 --> 00:00:02,370
Giờ hãy nói về AWS WAF,

2
00:00:02,370 --> 00:00:04,530
Web Application Firewall.

3
00:00:04,530 --> 00:00:07,440
Nó được dùng để bảo vệ ứng dụng web của bạn

4
00:00:07,440 --> 00:00:10,530
khỏi các kiểu tấn công phổ biến ở Layer 7.

5
00:00:10,530 --> 00:00:12,840
Nhắc lại, Layer 7 là HTTP,

6
00:00:12,840 --> 00:00:15,150
nên nó bảo vệ bạn khỏi các khai thác HTTP.

7
00:00:15,150 --> 00:00:19,620
Trong khi Layer 4 dùng cho giao thức TCP hoặc UDP.

8
00:00:19,620 --> 00:00:23,280
WAF có thể triển khai

9
00:00:23,280 --> 00:00:28,260
trên Application Load Balancer, API Gateway, CloudFront,

10
00:00:28,260 --> 00:00:33,030
AppSync GraphQL API hoặc Cognito user pool.

11
00:00:33,030 --> 00:00:34,260
Hãy nhớ điều này rất quan trọng.

12
00:00:34,260 --> 00:00:35,700
Bạn phải nhớ các dịch vụ mà WAF hỗ trợ,

13
00:00:35,700 --> 00:00:37,470
vì đề thi sẽ dễ đánh lừa bạn,

14
00:00:37,470 --> 00:00:40,680
ví dụ bắt bạn triển khai WAF trên NLB

15
00:00:40,680 --> 00:00:42,660
nhưng điều đó là không thể.

16
00:00:42,660 --> 00:00:46,590
Sau khi bạn triển khai firewall cho các dịch vụ này,

17
00:00:46,590 --> 00:00:48,330
bạn có thể định nghĩa web ACL,

18
00:00:48,330 --> 00:00:51,150
tức web access control list và các rule của chúng.

19
00:00:51,150 --> 00:00:53,400
Bạn có thể tạo rule, chẳng hạn

20
00:00:53,400 --> 00:00:56,190
lọc dựa trên địa chỉ IP.

21
00:00:56,190 --> 00:00:58,050
Bạn có thể tạo IP set.

22
00:00:58,050 --> 00:01:01,260
Mỗi IP set chứa tối đa 10.000 địa chỉ IP.

23
00:01:01,260 --> 00:01:03,540
Nếu cần nhiều IP hơn,

24
00:01:03,540 --> 00:01:05,820
bạn có thể dùng nhiều rule.

25
00:01:05,820 --> 00:01:09,000
Bạn cũng có thể lọc theo HTTP header hoặc body.

26
00:01:09,000 --> 00:01:12,000
Có thể dùng chuỗi URI để bảo vệ

27
00:01:12,000 --> 00:01:14,790
chống lại các tấn công phổ biến như SQL injection

28
00:01:14,790 --> 00:01:16,890
và cross-site scripting.

29
00:01:16,890 --> 00:01:18,990
Bạn có thể đặt giới hạn kích thước để đảm bảo

30
00:01:18,990 --> 00:01:22,260
request chỉ tối đa, ví dụ, hai megabyte

31
00:01:22,260 --> 00:01:26,280
hoặc dùng geo match để cho phép hay chặn quốc gia cụ thể.

32
00:01:26,280 --> 00:01:28,800
Bạn thậm chí có thể có rule dựa trên tốc độ

33
00:01:28,800 --> 00:01:31,890
đếm số request theo từng IP

34
00:01:31,890 --> 00:01:35,100
để bảo vệ DDoS, ví dụ ngăn một IP cụ thể

35
00:01:35,100 --> 00:01:38,040
gửi quá 10 request mỗi giây.

36
00:01:38,040 --> 00:01:42,660
Các web ACL này là regional, trừ CloudFront

37
00:01:42,660 --> 00:01:45,240
nơi chúng được định nghĩa toàn cầu.

38
00:01:45,240 --> 00:01:47,970
Nếu bạn thấy thuật ngữ rule group,

39
00:01:47,970 --> 00:01:50,490
đó là tập hợp các rule

40
00:01:50,490 --> 00:01:52,590
mà bạn có thể thêm vào nhiều web ACL.

41
00:01:52,590 --> 00:01:54,750
Dùng để tổ chức chúng.

42
00:01:54,750 --> 00:01:56,580
WAF có một tình huống sử dụng thú vị.

43
00:01:56,580 --> 00:02:01,200
Nếu bạn muốn có IP cố định cho ứng dụng

44
00:02:01,200 --> 00:02:05,580
khi dùng WAF cùng application load balancer thì sao?

45
00:02:05,580 --> 00:02:08,910
WAF không hỗ trợ Network Load Balancer

46
00:02:08,910 --> 00:02:13,910
vì NLB hoạt động ở Layer 4 còn WAF ở Layer 7.

47
00:02:13,920 --> 00:02:17,640
Do đó để dùng WAF, bạn cần

48
00:02:17,640 --> 00:02:20,160
một application load balancer.

49
00:02:20,160 --> 00:02:22,290
Nhưng chúng ta biết application balancer

50
00:02:22,290 --> 00:02:23,940
không có IP cố định.

51
00:02:23,940 --> 00:02:26,700
Để giải quyết, ta có thể dùng Global Accelerator

52
00:02:26,700 --> 00:02:28,770
để lấy IP cố định cho ứng dụng

53
00:02:28,770 --> 00:02:32,010
và bật WAF trên ALB.

54
00:02:32,010 --> 00:02:34,080
Kiến trúc sẽ như sau.

55
00:02:34,080 --> 00:02:37,080
Chúng ta có một region với ALB và các EC2 instance.

56
00:02:37,080 --> 00:02:40,410
Chúng ta đặt Global Accelerator phía trước ALB

57
00:02:40,410 --> 00:02:43,560
để có IP cố định cho ứng dụng.

58
00:02:43,560 --> 00:02:46,260
Và chúng ta gắn Web Application Firewall

59
00:02:46,260 --> 00:02:49,500
cùng WebACL trong cùng region

60
00:02:49,500 --> 00:02:53,250
nơi application load balancer đặt.

61
00:02:53,250 --> 00:02:56,490
Như vậy, ta đạt được kiến trúc mong muốn.

62
00:02:56,490 --> 00:02:58,110
Bài học đến đây là kết thúc.

63
00:02:58,110 --> 00:02:59,400
Hy vọng bạn thích.

64
00:02:59,400 --> 00:03:01,350
Hẹn gặp bạn trong bài giảng tiếp theo.
