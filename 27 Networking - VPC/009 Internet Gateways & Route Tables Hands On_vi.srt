1
00:00:00,310 --> 00:00:01,730
Trước hết hãy đảm bảo

2
00:00:01,730 --> 00:00:04,327
rằng các EC2 instance trong các subnet này

3
00:00:04,327 --> 00:00:06,930
không có quyền truy cập Internet.

4
00:00:06,930 --> 00:00:09,630
Để kiểm tra, vào EC2 Console

5
00:00:09,630 --> 00:00:11,910
và chúng ta sẽ khởi chạy một instance

6
00:00:11,910 --> 00:00:13,040
vào các subnet này.

7
00:00:13,040 --> 00:00:15,573
Nhấn Launch instances.

8
00:00:16,810 --> 00:00:20,252
Chọn Amazon Linux 2 ở bên dưới.

9
00:00:20,252 --> 00:00:21,290
T2.micro, ổn.

10
00:00:21,290 --> 00:00:23,660
Tôi sẽ không chọn key pair.

11
00:00:23,660 --> 00:00:26,340
Trong Network settings, tôi sẽ Edit.

12
00:00:26,340 --> 00:00:28,730
Tại đây, tôi chọn VPC vừa tạo

13
00:00:28,730 --> 00:00:29,683
đặt tên DemoVPC.

14
00:00:30,890 --> 00:00:33,980
Sau đó có thể chọn bất kỳ subnet nào.

15
00:00:33,980 --> 00:00:37,220
Ví dụ dùng Public Subnet A.

16
00:00:37,220 --> 00:00:39,410
Có 251 địa chỉ IP sẵn sàng

17
00:00:39,410 --> 00:00:40,980
nên có thể khởi chạy ở đây.

18
00:00:40,980 --> 00:00:42,360
Bạn thấy

19
00:00:42,360 --> 00:00:46,710
thiết lập auto-assign public IP hiện đang Disabled.

20
00:00:46,710 --> 00:00:48,460
Nếu muốn có địa chỉ IPv4 public

21
00:00:48,460 --> 00:00:51,010
thì dĩ nhiên phải Enable mục này.

22
00:00:51,010 --> 00:00:53,403
Nhưng tại sao mặc định lại bị tắt?

23
00:00:53,403 --> 00:00:55,330
Trong khi nếu tôi chọn một subnet khác

24
00:00:55,330 --> 00:00:58,380
từ trước, thì mặc định lại được bật (bạn có thể thử).

25
00:00:58,380 --> 00:01:01,810
Ý tưởng là nếu bạn vào cài đặt Subnet,

26
00:01:01,810 --> 00:01:06,410
bạn sẽ thấy, ví dụ Public Subnet A ở đây.

27
00:01:06,410 --> 00:01:08,210
Nhấn Actions rồi Edit subnet settings.

28
00:01:08,210 --> 00:01:10,930
Tại đây có thể Enable

29
00:01:10,930 --> 00:01:14,830
auto-assign public IPv4 address

30
00:01:14,830 --> 00:01:17,160
— điều chúng ta muốn cho các Public Subnet.

31
00:01:17,160 --> 00:01:19,660

32
00:01:19,660 --> 00:01:23,630

33
00:01:23,630 --> 00:01:27,780
Và tôi cũng cần bật mục này

34
00:01:27,780 --> 00:01:30,800
cho Public Subnet B.

35
00:01:30,800 --> 00:01:33,090
Vào Actions → Edit subnet settings → Save.

36
00:01:33,090 --> 00:01:38,090

37
00:01:38,570 --> 00:01:39,403
Giờ nếu tôi refresh toàn bộ trang

38
00:01:39,403 --> 00:01:41,230
và tạo instance mới,

39
00:01:41,230 --> 00:01:44,220

40
00:01:44,220 --> 00:01:48,490
vào lại Network settings và nhấn Edit,

41
00:01:48,490 --> 00:01:49,323

42
00:01:50,210 --> 00:01:52,210
chọn DemoVPC,

43
00:01:52,210 --> 00:01:54,000
chọn Public Subnet A,

44
00:01:54,000 --> 00:01:55,650
thì mặc định bây giờ

45
00:01:55,650 --> 00:01:59,410
auto-assign public IP đã là Enabled.

46
00:01:59,410 --> 00:02:02,180
Ta đã thay đổi mặc định ở Subnet

47
00:02:02,180 --> 00:02:06,480
và nó phản ánh vào trang khởi chạy EC2.

48
00:02:06,480 --> 00:02:07,313
Tốt.

49
00:02:07,313 --> 00:02:10,560
Tạo một Security Group mới

50
00:02:10,560 --> 00:02:13,250
và thêm rule SSH (port 22),

51
00:02:13,250 --> 00:02:16,053
vì chúng ta sẽ SSH vào EC2 instance.

52
00:02:17,150 --> 00:02:18,940
Các phần khác ổn, tiến hành

53
00:02:18,940 --> 00:02:20,623
Launch instance.

54
00:02:23,010 --> 00:02:24,060
Hoàn tất.

55
00:02:25,000 --> 00:02:27,080
Instance đã chạy.

56
00:02:27,080 --> 00:02:31,000
Bạn thấy nó được gán một địa chỉ IPv4 public.

57
00:02:31,000 --> 00:02:33,450
Tức là có IPv4 public

58
00:02:33,450 --> 00:02:35,900
nhưng lại chưa có kết nối Internet.

59
00:02:35,900 --> 00:02:36,733
Xác minh thế nào?

60
00:02:36,733 --> 00:02:37,840
Thử kết nối

61
00:02:37,840 --> 00:02:40,560
bằng EC2 Instance Connect

62
00:02:40,560 --> 00:02:42,070
và nhấn Connect.

63
00:02:42,070 --> 00:02:46,890
Nhớ là ta đã mở rule SSH trên instance,

64
00:02:46,890 --> 00:02:48,980
nhưng vẫn gặp lỗi khi kết nối.

65
00:02:48,980 --> 00:02:51,420
Có thể do Network settings của instance

66
00:02:51,420 --> 00:02:53,080
chưa được cấu hình đúng.

67
00:02:53,080 --> 00:02:56,100
Đây là lúc Internet Gateway phát huy tác dụng.

68
00:02:56,100 --> 00:02:58,940
Hãy thêm một Internet Gateway.

69
00:02:58,940 --> 00:02:59,900
Đây là VPC của tôi.

70
00:02:59,900 --> 00:03:03,000
Chưa có Internet Gateway nào được gắn.

71
00:03:03,000 --> 00:03:04,600
Nếu bỏ filter,

72
00:03:04,600 --> 00:03:05,960
bạn sẽ thấy có Internet Gateway

73
00:03:05,960 --> 00:03:07,680
đã gắn với Default VPC.

74
00:03:07,680 --> 00:03:09,190
Tạo một Internet Gateway mới

75
00:03:09,190 --> 00:03:10,830
đặt tên DemoIGW

76
00:03:12,180 --> 00:03:14,220
(IGW là viết tắt của Internet Gateway),

77
00:03:14,220 --> 00:03:15,970
rồi Create Internet Gateway.

78
00:03:15,970 --> 00:03:17,710
Rất đơn giản.

79
00:03:17,710 --> 00:03:20,450
Đã tạo xong và trạng thái là Detached.

80
00:03:20,450 --> 00:03:23,200
Chúng ta cần Attach vào một VPC,

81
00:03:23,200 --> 00:03:24,720
và dĩ nhiên là DemoVPC.

82
00:03:24,720 --> 00:03:26,950

83
00:03:26,950 --> 00:03:30,660
Bây giờ IGW đã gắn với VPC

84
00:03:30,660 --> 00:03:34,430
để cung cấp truy cập Internet cho VPC.

85
00:03:34,430 --> 00:03:36,520
Thử lại EC2 Instance Connect xem sao.

86
00:03:36,520 --> 00:03:37,360
Liệu có hoạt động?

87
00:03:37,360 --> 00:03:38,943
Thử Connect lại.

88
00:03:43,510 --> 00:03:45,030
Vẫn gặp lỗi kết nối.

89
00:03:45,030 --> 00:03:46,730
Chuyện gì đang xảy ra?

90
00:03:46,730 --> 00:03:48,040
Dù đã có Internet Gateway,

91
00:03:48,040 --> 00:03:50,260
chúng ta vẫn cần một Route.

92
00:03:50,260 --> 00:03:52,330
Tức là phải chỉnh Route Table.

93
00:03:52,330 --> 00:03:54,540
Nhìn vào Route Table này — đây là Default Route Table.

94
00:03:54,540 --> 00:03:56,590

95
00:03:56,590 --> 00:03:58,500
Default Route Table

96
00:04:00,090 --> 00:04:01,910
sẽ được gán (ngầm) cho các Subnet

97
00:04:01,910 --> 00:04:23,940
chưa có Route Table riêng.

98
00:04:23,940 --> 00:04:26,390
Tôi sẽ tạo một Route Table mới

99
00:04:26,390 --> 00:04:28,703
đặt tên PublicRouteTable,

100
00:04:30,370 --> 00:04:33,330
gán vào DemoVPC.

101
00:04:33,330 --> 00:04:36,280
Và tạo Route Table thứ hai

102
00:04:37,981 --> 00:04:38,814
đặt tên PrivateRouteTable,

103
00:04:38,814 --> 00:04:42,010

104
00:04:42,010 --> 00:04:43,300
cũng gán vào DemoVPC.

105
00:04:43,300 --> 00:04:46,040
Lý do: tôi muốn gán các Subnet

106
00:04:46,040 --> 00:04:48,150
vào đúng Route Table.

107
00:04:48,150 --> 00:04:49,560
PublicRouteTable sẽ có Subnet Associations.

108
00:04:49,560 --> 00:04:51,730
Chỉnh mục này

109
00:04:51,730 --> 00:04:54,450
và thêm toàn bộ Public Subnet

110
00:04:55,460 --> 00:04:58,840
vào PublicRouteTable.

111
00:04:58,840 --> 00:05:01,290
Nhấn Save.

112
00:05:01,290 --> 00:05:02,123
Với PrivateRouteTable,

113
00:05:02,123 --> 00:05:04,710
tôi cũng Edit Subnet Associations

114
00:05:04,710 --> 00:05:07,580
và gán vào các Private Subnet A và B.

115
00:05:07,580 --> 00:05:09,750
Lưu các liên kết này.

116
00:05:09,750 --> 00:05:13,130
Ổn rồi.

117
00:05:13,130 --> 00:05:14,660
Như vậy Public/Private Route Table

118
00:05:14,660 --> 00:05:15,860
đều có 2 Subnet được gán.

119
00:05:15,860 --> 00:05:17,370
Còn Main Route Table

120
00:05:17,370 --> 00:05:18,960
không có Subnet nào gán nữa

121
00:05:18,960 --> 00:05:22,409
vì tất cả Subnet đã được gán tường minh — tốt hơn rồi.

122
00:05:22,409 --> 00:05:25,160
Bây giờ vào PublicRouteTable.

123
00:05:25,160 --> 00:05:26,990
EC2 instance của chúng ta được tạo

124
00:05:26,990 --> 00:05:29,850
trong Public Subnet,

125
00:05:29,850 --> 00:05:31,410
nên nó dùng PublicRouteTable.

126
00:05:31,410 --> 00:05:33,050
Và chúng ta sẽ Edit Routes

127
00:05:33,050 --> 00:05:36,230
trong PublicRouteTable.

128
00:05:36,230 --> 00:05:40,280
Xem các Route hiện tại, có rule cho 10.0.0.0/16

129
00:05:40,280 --> 00:05:43,570
trỏ tới local.

130
00:05:43,570 --> 00:05:45,990
Tức là mọi IP thuộc VPC (VPC CIDR)

131
00:05:45,990 --> 00:05:47,210
được định tuyến nội bộ (target = local).

132
00:05:47,210 --> 00:05:49,240
Chúng ta sẽ Edit routes và thêm một route thứ hai

133
00:05:49,240 --> 00:05:51,330
— sử dụng 0.0.0.0/0,

134
00:05:51,330 --> 00:05:52,810
tức là “mọi IP”.

135
00:05:52,810 --> 00:05:54,800
Mọi IP không khớp rule nội bộ

136
00:05:54,800 --> 00:05:55,633
sẽ có target là:

137
00:05:55,633 --> 00:05:58,490
— ở đây có nhiều lựa chọn —

138
00:05:58,490 --> 00:06:01,760
nhưng với Internet thì target phải là Internet Gateway

139
00:06:01,760 --> 00:06:03,240
mà ta vừa tạo.

140
00:06:03,240 --> 00:06:05,510
Nói cách khác: nếu là IP nội bộ trong CIDR,

141
00:06:05,510 --> 00:06:07,560
hãy route local;

142
00:06:07,560 --> 00:06:09,790
còn lại (kể cả IP public)

143
00:06:09,790 --> 00:06:13,180
thì route tới Internet Gateway.

144
00:06:13,180 --> 00:06:15,590
Lưu thay đổi.

145
00:06:15,590 --> 00:06:17,010
Bây giờ EC2 của chúng ta

146
00:06:17,010 --> 00:06:18,380
đã có quyền ra Internet.

147
00:06:18,380 --> 00:06:20,810
Thử lại nào.

148
00:06:20,810 --> 00:06:23,210
Chọn EC2 instance → EC2 Instance Connect → Connect.

149
00:06:23,210 --> 00:06:24,680

150
00:06:24,680 --> 00:06:27,640
Bây giờ tôi đã vào được EC2 instance

151
00:06:27,640 --> 00:06:30,140
và nó có kết nối Internet.

152
00:06:30,140 --> 00:06:30,973
Ví dụ: ping google.com

153
00:06:30,973 --> 00:06:32,340


154
00:06:36,910 --> 00:06:39,760
Bạn thấy chúng ta nhận được phản hồi từ Google.

155
00:06:39,760 --> 00:06:41,210
Tức là đã có Internet.

156
00:06:41,210 --> 00:06:44,030
Mọi thứ hoạt động tốt.

157
00:06:44,030 --> 00:06:46,070
Hiện tại chúng ta mới cấp Internet

158
00:06:46,070 --> 00:06:47,970
cho các Public Subnet

159
00:06:47,970 --> 00:06:49,680
thông qua Public Route Table.

160
00:06:49,680 --> 00:06:51,230
Chúng ta vẫn chưa biết cách

161
00:06:51,230 --> 00:06:54,780
cho các EC2 Private ra Internet,

162
00:06:54,780 --> 00:06:56,020
và sẽ học ở các bài tiếp theo.

