1
00:00:00,348 --> 00:00:03,111
Hóa ra EC2 instance mà chúng ta đã tạo

2
00:00:03,111 --> 00:00:06,481
trong Public Subnet có thể được đặt tên là

3
00:00:06,481 --> 00:00:08,994
Bastion Host.

4
00:00:08,994 --> 00:00:10,510
Vì chúng ta có thể SSH

5
00:00:10,510 --> 00:00:13,000
vào Bastion Host này và

6
00:00:13,000 --> 00:00:15,780
từ đó kết nối tới một EC2 instance

7
00:00:15,780 --> 00:00:17,260
ở Private Subnet.

8
00:00:17,260 --> 00:00:19,691
Để làm được, hãy tạo một EC2

9
00:00:19,691 --> 00:00:22,180
ở Private Subnet; trước tiên nếu bạn chưa có

10
00:00:22,180 --> 00:00:24,910
Key Pair — đôi khi tôi tái sử dụng tài khoản

11
00:00:24,910 --> 00:00:26,090
hoặc tạo mới —

12
00:00:26,090 --> 00:00:27,810
thì có thể chưa có Key Pair.

13
00:00:27,810 --> 00:00:30,190
Bạn có thể tạo một Key Pair mới.

14
00:00:30,190 --> 00:00:33,410
Tôi sẽ tạo “demo-key-pair”,

15
00:00:33,410 --> 00:00:34,952
định dạng PEM.

16
00:00:34,952 --> 00:00:37,750
Rồi tạo Key Pair.

17
00:00:37,750 --> 00:00:41,220
Lưu file này — chúng ta sẽ dùng nó để SSH

18
00:00:41,220 --> 00:00:44,960
vào EC2 trong Private Subnet.

19
00:00:44,960 --> 00:00:47,010
Hãy xem cách thực hiện.

20
00:00:48,291 --> 00:00:49,124
Vào EC2 Instances

21
00:00:49,124 --> 00:00:52,070
và khởi chạy một EC2 instance.

22
00:00:52,070 --> 00:00:56,380
Chọn Amazon Linux 2, t2.micro.

23
00:00:56,380 --> 00:00:58,950
Chọn Key Pair vừa tạo: demo-key-pair.

24
00:00:58,950 --> 00:01:00,590

25
00:01:00,590 --> 00:01:02,410
Trong Network settings, đảm bảo

26
00:01:02,410 --> 00:01:05,051
khởi chạy trong DemoVPC.

27
00:01:05,051 --> 00:01:07,300
Về Subnet association,

28
00:01:07,300 --> 00:01:10,290
chúng ta muốn Private Subnet, ví dụ

29
00:01:10,290 --> 00:01:14,020
PrivateSubnetA, và tạo một Security Group.

30
00:01:14,020 --> 00:01:15,393

31
00:01:16,811 --> 00:01:19,470
Tôi đặt tên là private-sg vì đây là

32
00:01:19,470 --> 00:01:23,131
Security Group cho Private, và sẽ cho phép SSH

33
00:01:26,530 --> 00:01:28,870
từ Bastion Host.

34
00:01:28,870 --> 00:01:31,200
Lần này tôi sẽ chọn Security Group đã tạo trước đó

35
00:01:31,200 --> 00:01:32,880
(trước đây tên launch-wizard-1 —

36
00:01:32,880 --> 00:01:34,960
tôi sẽ sớm đổi tên cho rõ ràng),

37
00:01:34,960 --> 00:01:39,960
nghĩa là ta cho phép SSH đến từ Bastion Host.

38
00:01:42,000 --> 00:01:43,590
Nhờ “nhảy qua” Bastion Host,

39
00:01:43,590 --> 00:01:45,650
chúng ta sẽ SSH được vào Private Instance.

40
00:01:45,650 --> 00:01:48,750

41
00:01:48,750 --> 00:01:50,740
Ổn rồi.

42
00:01:50,740 --> 00:01:53,393
Giờ hãy khởi chạy instance đó.

43
00:01:55,800 --> 00:01:59,640
Xong.

44
00:01:59,640 --> 00:02:04,640
Đây là Private Instance; vì nó ở Private Subnet

45
00:02:05,720 --> 00:02:07,440
như bạn biết,

46
00:02:07,440 --> 00:02:09,550
không thể dùng EC2 Instance Connect

47
00:02:09,550 --> 00:02:11,240
để vào (sẽ không hoạt động).

48
00:02:11,240 --> 00:02:12,940
Ta có thể sửa Route Table và thêm Internet Gateway,

49
00:02:12,940 --> 00:02:15,400
nhưng như vậy subnet sẽ trở thành Public.

50
00:02:15,400 --> 00:02:17,090
Vì thế ta sẽ SSH

51
00:02:17,090 --> 00:02:18,960
thông qua Bastion Host.

52
00:02:18,960 --> 00:02:21,890
Xem cách làm.

53
00:02:21,890 --> 00:02:24,470
Kết nối vào Bastion Host.

54
00:02:24,470 --> 00:02:27,670
Nhấn Connect → EC2 Instance Connect.

55
00:02:27,670 --> 00:02:30,319
Về bản chất, chúng ta đang

56
00:02:30,319 --> 00:02:31,290
SSH vào Bastion Host.

57
00:02:31,290 --> 00:02:33,421
Bạn có thể dùng EC2 Instance Connect, hoặc

58
00:02:33,421 --> 00:02:37,010
lệnh ssh trên terminal của bạn.

59
00:02:37,010 --> 00:02:38,780
Từ Bastion Host

60
00:02:38,780 --> 00:02:41,270
chúng ta muốn kết nối tới Private Instance.

61
00:02:41,270 --> 00:02:42,103
Private Instance của chúng ta

62
00:02:42,103 --> 00:02:44,840
có một địa chỉ IPv4 private.

63
00:02:44,840 --> 00:02:45,673
Vậy cần làm gì?

64
00:02:45,673 --> 00:02:49,640
Chạy lệnh: ssh ec2-user@<private-ip>

65
00:02:49,640 --> 00:02:53,460
và chỉ định Key Pair (file .pem).

66
00:02:53,460 --> 00:02:55,810
Nếu không chỉ định Key Pair,

67
00:02:55,810 --> 00:02:57,270
lệnh sẽ không hoạt động.

68
00:02:57,270 --> 00:03:00,050
Vì vậy chúng ta cần có file Key Pair

69
00:03:00,050 --> 00:03:02,130
trên Bastion Host (EC2 public).

70
00:03:02,130 --> 00:03:07,130
Tôi sẽ dùng vi hoặc nano

71
00:03:07,190 --> 00:03:11,100
và tạo file demo-key-pair.pem

72
00:03:11,100 --> 00:03:13,490
rồi dán nội dung

73
00:03:13,490 --> 00:03:15,170
của Key Pair vừa tải về.

74
00:03:15,170 --> 00:03:18,270
Mở file .pem trên máy bạn bằng trình soạn thảo

75
00:03:18,270 --> 00:03:20,821
và dán nguyên nội dung vào đây,

76
00:03:20,821 --> 00:03:22,930
đảm bảo định dạng đúng.

77
00:03:22,930 --> 00:03:25,180
Có thể cần thêm dòng trống cuối file.

78
00:03:25,180 --> 00:03:26,780
Ổn rồi.

79
00:03:28,632 --> 00:03:29,731
Kiểm tra lại,

80
00:03:29,731 --> 00:03:31,632
lưu và thoát.

81
00:03:31,632 --> 00:03:32,800
Clear màn hình.

82
00:03:32,800 --> 00:03:35,460
Đảm bảo file đã lưu đúng.

83
00:03:35,460 --> 00:03:36,890
Có vẻ ổn.

84
00:03:36,890 --> 00:03:37,723
Kiểm tra thêm.

85
00:03:37,723 --> 00:03:38,790
Nếu còn bối rối về định dạng,

86
00:03:38,790 --> 00:03:40,590
hãy kiểm tra kỹ lại.

87
00:03:40,590 --> 00:03:44,100
Nhớ đổi permission của file .pem.

88
00:03:44,100 --> 00:03:47,350
Tôi sẽ chmod cho file demo-key-pair.pem.

89
00:03:47,350 --> 00:03:51,090
Giờ chạy lệnh ssh -i demo-key-pair.pem ...

90
00:03:51,090 --> 00:03:55,211
Nếu gặp lỗi, nhiều khả năng

91
00:03:55,211 --> 00:03:58,790
là do định dạng file chưa đúng.

92
00:03:58,790 --> 00:04:00,180
Tôi sẽ xóa file demo-key-pair.pem

93
00:04:00,180 --> 00:04:01,780
và tạo lại.

94
00:04:01,780 --> 00:04:03,530
Đúng vậy, xóa đi.

95
00:04:03,530 --> 00:04:04,930
Tôi sẽ thử trình soạn thảo khác.

96
00:04:04,930 --> 00:04:08,200
vi demo-key-pair.pem

97
00:04:08,200 --> 00:04:10,970
Tôi giữ đoạn này trong video

98
00:04:10,970 --> 00:04:12,370
vì rất quan trọng để thấy

99
00:04:12,370 --> 00:04:15,330
những lỗi có thể gặp và cách xử lý.

100
00:04:15,330 --> 00:04:17,600
Bây giờ trông đã tốt hơn.

101
00:04:17,600 --> 00:04:19,370
Lưu file.

102
00:04:19,370 --> 00:04:22,029

103
00:04:22,029 --> 00:04:27,030
Chạy lại lệnh ssh.

104
00:04:27,410 --> 00:04:28,360
Nếu bị cảnh báo “unprotected”,

105
00:04:28,360 --> 00:04:30,590
hãy chạy chmod để chỉnh quyền trước.

106
00:04:30,590 --> 00:04:32,020
Đã xong.

107
00:04:32,020 --> 00:04:34,100
Thử ssh lại — được rồi.

108
00:04:34,100 --> 00:04:34,933
Đã kết nối thành công.

109
00:04:34,933 --> 00:04:38,360
Hiện chúng ta đã SSH vào

110
00:04:38,360 --> 00:04:40,650
Amazon Linux 2 (AMI) trong Private Subnet.

111
00:04:40,650 --> 00:04:42,440
Rất tốt.

112
00:04:42,440 --> 00:04:44,810
Chúng ta đi từ Bastion Host vào Private Instance

113
00:04:44,810 --> 00:04:46,880
và hoạt động như mong muốn.

114
00:04:46,880 --> 00:04:49,550
Nhưng nếu thử ping google.com

115
00:04:49,550 --> 00:04:50,970
thì sẽ không chạy.

116
00:04:50,970 --> 00:04:52,890
Private EC2 instance hiện chưa

117
00:04:52,890 --> 00:04:54,832
có outbound Internet.

118
00:04:54,832 --> 00:04:56,740
Chúng ta sẽ xử lý việc này

119
00:04:56,740 --> 00:04:57,573
ở bài tiếp theo.

120
00:04:57,573 --> 00:04:59,390
Tới đây, bạn đã thấy cách dùng Bastion Host.

121
00:04:59,390 --> 00:05:00,223
Tuyệt vời.

122
00:05:00,223 --> 00:05:02,110
Hẹn gặp lại ở bài kế tiếp.

